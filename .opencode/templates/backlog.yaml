# OpenCode Backlog Template - Format Specification
#
# This template is the canonical format specification for backlog items.
# analyst-agent reads this file to understand structure, conventions, and formatting.
# When copied to docs/backlog.yaml, it becomes the operational backlog.
#
# IMPORTANT: This is a SINGLE FILE system. Do not create additional backlog files.

# ============================================================================
# ID FORMAT CONVENTIONS
# ============================================================================
# - Epics:   EP-001, EP-002, ... EP-999 (3-digit zero-padded)
# - Stories: US-001, US-002, ... US-999 (3-digit zero-padded)
# - Tasks:   TK-001, TK-002, ... TK-999 (3-digit zero-padded)
#
# When creating new items:
# 1. Read current counter value (e.g., story: 5)
# 2. Increment by 1 (6)
# 3. Format with 3-digit padding (006)
# 4. Prefix with type (US-006)
# 5. Update counter in this file (story: 6)

# ============================================================================
# STATE WORKFLOWS
# ============================================================================
# Epic states:
#   proposed → in_progress → done
#                         ↘ cancelled
#
# Story states:
#   draft → ready → in_progress → in_review → done
#                                           ↘ cancelled
#
# Task states:
#   todo → doing → review → done
#       ↘ blocked ↗

# ============================================================================
# YAML FORMATTING RULES
# ============================================================================
# - Indentation: 2 spaces (NO TABS)
# - Multiline strings: Use | (pipe) for description, notes, then fields
# - String quoting: Use quotes for strings with special chars or colons
# - Arrays: Use [] for inline arrays (e.g., dependsOn: [TK-001, TK-002])
#          Use - for block arrays (e.g., scenarios list)
# - Dates: Format as YYYY-MM-DD (e.g., 2025-11-26)

# ============================================================================
# CONTENT STANDARDS
# ============================================================================
# - INVEST: Each story must be Independent, Negotiable, Valuable,
#           Estimable, Small, Testable
# - GHERKIN: Minimum 3 scenarios per story:
#            1. Happy path (successful flow)
#            2. Validation error (invalid input)
#            3. Edge case (boundary condition, timeout, etc.)
# - Architecture: All stories validated by architect-agent with notes,
#                 risks, and mitigations

# ============================================================================
# VERSION AND COUNTERS
# ============================================================================
version: 1

counters:
  epic: 0    # Increment when creating epics
  story: 0   # Increment when creating stories
  task: 0    # Increment when creating tasks

# ============================================================================
# EPICS
# ============================================================================
# Epics are strategic initiatives that group related stories
epics: []

# ============================================================================
# STORIES
# ============================================================================
# Stories are user-facing features with INVEST principles and GHERKIN criteria
# Tasks are embedded within their parent story
stories: []

# ============================================================================
# EXAMPLE EPIC (uncomment and modify to create)
# ============================================================================
# epics:
#   - id: EP-001                    # [REQUIRED] Auto-incremented ID
#     title: Checkout Payments      # [REQUIRED] Brief epic title
#     outcome: Reduce checkout abandonment by 20%  # [REQUIRED] Measurable outcome
#     kpi:                           # [OPTIONAL] Key performance indicators
#       - name: checkout_completion_rate
#         target: ">= 80%"
#     status: proposed               # [REQUIRED] Current state
#     owner: PO                      # [REQUIRED] Epic owner
#     createdAt: 2025-11-18          # [REQUIRED] Creation date (YYYY-MM-DD)
#     updatedAt: 2025-11-18          # [REQUIRED] Last update date
#     links: []                      # [OPTIONAL] Related documentation URLs
#     history:                       # [REQUIRED] Change log
#       - at: 2025-11-18
#         what: created
#         by: analyst

# ============================================================================
# EXAMPLE STORY (uncomment and modify to create)
# ============================================================================
# stories:
#   - id: US-001                     # [REQUIRED] Auto-incremented ID
#     epicId: EP-001                 # [OPTIONAL] Link to parent epic
#     title: As a buyer I want to pay with a card so that I can complete my order
#                                    # [REQUIRED] As a...I want...so that format
#     description: |                 # [REQUIRED] Business context (use | for multiline)
#       As a buyer
#       I want to pay with a card
#       So that I can complete the order without friction
#
#       [Add business context, constraints, rules here]
#
#     priority: high                 # [REQUIRED] high | medium | low
#     estimate: 5                    # [REQUIRED] Story points (1-8)
#     status: draft                  # [REQUIRED] Current state
#     owner: team-alpha              # [REQUIRED] Team responsible
#
#     acceptance:                    # [REQUIRED] GHERKIN scenarios
#       feature: "Pay with card"     # [REQUIRED] Feature name
#       scenarios:                   # [REQUIRED] Minimum 3 scenarios
#         - name: Happy path         # [REQUIRED] Scenario name
#           given: "A valid cart and a valid card"
#           when: "I confirm the payment"
#           then: "The order is confirmed and I receive a receipt"
#
#         - name: Card validation error
#           given: "An expired card"
#           when: "I attempt the payment"
#           then: "I see an error message and the payment does not proceed"
#
#         - name: Gateway timeout edge case
#           given: "The payment gateway responds over SLA"
#           when: "I attempt the payment"
#           then: "The system retries per policy and informs me of a possible delay"
#
#     nfr:                           # [OPTIONAL] Non-functional requirements
#       - key: latency_p95_ms        # Measurable metric
#         target: "<= 800"           # Target threshold
#       - key: availability
#         target: ">= 99.9%"
#
#     architecture:                  # [REQUIRED] From architect-agent
#       notes: |                     # [REQUIRED] Technical approach
#         Proposal: integrate with PSP X via REST; timeout 3s, 2 retries with backoff; idempotency key.
#         Structured logging; metrics: success/failure/latency. Webhook for async state.
#       risks:                       # [REQUIRED] Technical risks
#         - "Dependency on PSP X during peak hours"
#         - "Idempotency handling across retries"
#       mitigations:                 # [REQUIRED] Risk mitigations
#         - "Circuit breaker + async retry fallback"
#         - "Idempotency key per request"
#
#     links: []                      # [OPTIONAL] Related docs, designs
#
#     createdAt: 2025-11-18          # [REQUIRED] Creation date
#     updatedAt: 2025-11-18          # [REQUIRED] Last update
#
#     history:                       # [REQUIRED] Change history
#       - at: 2025-11-18
#         what: created
#         by: analyst
#       - at: 2025-11-18
#         what: validated_by_architect
#         by: architect
#
#     tasks:                         # [OPTIONAL] Implementation tasks (2-5 recommended)
#       - id: TK-001                 # [REQUIRED] Auto-incremented task ID
#         storyId: US-001            # [REQUIRED] Parent story reference
#         title: POST /payments endpoint with idempotency key
#                                    # [REQUIRED] Specific, actionable task
#         type: dev                  # [REQUIRED] dev | qa | design | docs
#         estimate: 1                # [REQUIRED] Days (0.5-2 typical)
#         status: todo               # [REQUIRED] Current state
#         owner: backend             # [REQUIRED] Role or team
#         dependsOn: []              # [OPTIONAL] IDs of prerequisite tasks
#         definitionOfDone:          # [REQUIRED] Completion criteria
#           - Unit tests passing
#           - Metrics exposed
#
#       - id: TK-002
#         storyId: US-001
#         title: Card form UI + validations
#         type: dev
#         estimate: 1
#         status: todo
#         owner: frontend
#         dependsOn: []
#         definitionOfDone:
#           - Client-side validations
#           - UX aligned with design system
#
#       - id: TK-003
#         storyId: US-001
#         title: E2E Gherkin scenarios (happy/error/timeout)
#         type: qa
#         estimate: 1
#         status: todo
#         owner: qa
#         dependsOn: [TK-001, TK-002]  # Waits for dev tasks
#         definitionOfDone:
#           - Scenarios executed in CI and passing
